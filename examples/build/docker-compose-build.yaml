services:
  g0efilter:
    build:
      context: ../..
      dockerfile: examples/build/Dockerfile
    container_name: g0efilter
    volumes:
      - ./policy.yaml:/app/policy.yaml:ro
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges
    read_only: true
    env_file:
      - ../.env
    environment:
      FILTER_MODE: ${FILTER_MODE:-https}
    cap_add:
      - NET_ADMIN

  g0efilter-dashboard:
    build:
      context: ../..
      dockerfile: examples/build/Dockerfile.dashboard
    container_name: g0efilter-dashboard
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges
    read_only: true
    env_file:
      - ../.env.dashboard
    network_mode: "service:g0efilter"

  tester:
    image: alpine/curl:latest
    container_name: tester
    command: sh -c "sleep infinity"
    depends_on:
      - g0efilter
    network_mode: "service:g0efilter"
